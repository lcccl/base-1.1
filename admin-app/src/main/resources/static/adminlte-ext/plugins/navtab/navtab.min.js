"use strict";!function(t,e){var a=function(t){if(this.events={},t)for(var e in t)this.addListener(e,t[e])};a.prototype={constructor:a,addListener:function(t,e){this._getEventQueue(t).push(e)},fireEvent:function(t){for(var e=this._getEventQueue(t),a=[],n=!0,r=1;r<arguments.length;r++)a.push(arguments[r]);for(r=0;r<e.length;r++)n=!1!==e[r].apply(this,a)&&n;return n},removeListener:function(t,e){for(var a=this._getEventQueue(t),n=0;n<a.length;n++)if(a[n]==e){a.splice(n,1);break}},clearListeners:function(t){this._getEventQueue(t).length=0},_getEventQueue:function(t){var e=this.events[t];return e||(this.events[t]=e=[]),e}},a.extend=function(t){var e=a.prototype;for(var n in e)"constructor"!=n&&(t[n]=e[n])},t.EventHandler=a}(window,jQuery),function(t,e){t.NavTab={init:function(t){var n=this;n.$ct=t,n.$tabHeader=e(".navtab-header",t),n.$tabContent=e(".navtab-content",t),n.$tabs=e(".navtab-tabs",n.$tabHeader),n.$tabsLeft=e(".navab-tabs-left",n.$tabHeader),n.$tabsRight=e(".navab-tabs-right",n.$tabHeader),n.tabs=[],n.tabsMap={},e("ul li",n.$tabHeader).each(function(){var t=e(this),r=e("[ref-tabId='"+t.attr("tabId")+"']",n.$tabContent),i=new a(t,r);n.addTab(i),t.hasClass("active")&&n.switchTab(i)}),n.$tabs.on("click","ul li",function(){var t=e(this).attr("tabId");n.currentTab&&n.currentTab.id!=t&&n.switchTab(t),n.scrollCurrentTab()}),n.$tabs.on("click","ul li .navtab-close",function(t){t.stopPropagation();var a=e(this).parent().attr("tabId");n.closeTab(a),n.doLayout()}),n.$tabsLeft.on("click",function(){n.scrollLeft(150)}),n.$tabsRight.on("click",function(){n.scrollRight(150)}),e.fn.contextMenu&&(n.$tabs.on("contextmenu",function(t){t.preventDefault()}),n.$tabs.on("mouseup","ul li",function(t){if(t.stopPropagation(),3==t.which){var a=e(this).attr("tabId"),r=n.findTab(a).tab;new e.fn.contextMenu.Menu({x:t.clientX,y:t.clientY,menus:[{text:"刷新标签页",handler:function(){n.switchTab(r),n.scrollCurrentTab(),r.load()}},{text:"关闭标签页",handler:function(){n.closeTab(r),n.doLayout()}},{text:"关闭其他标签页",handler:function(){n.closeOtherTabs(r)}},{text:"关闭全部标签页",handler:function(){n.closeAllTabs()}}]})}})),e(window).on("resize",function(){n.doLayout()})},openTab:function(t){var n=this,r=n.findTab(t.id).tab;(t=e.extend({},t)).iframe&&(t.html="<iframe class='navtab-iframe' src='"+t.url+"'></iframe>"),r?(n.switchTab(r),r.load(t)):(t.headerCt=e("ul",n.$tabHeader),t.contentCt=n.$tabContent,r=new a(t),n.addTab(r),n.switchTab(r),r.load()),n.doLayout(),n.scrollCurrentTab()},switchTab:function(t){var e=this.findTab(t).tab;this.currentTab&&this.currentTab.hide(),e.show(),this.currentTab=e},closeTab:function(t){var e=this,a=e.findTab(t),n=a.tabIdx,r=a.tab;if(r.close(),e.removeTab(r),r==e.currentTab)if(e.tabs.length>0){var i=n<e.tabs.length?n:e.tabs.length-1;e.currentTab=e.tabs[i],e.currentTab.show()}else e.currentTab=null},getCurrentTab:function(){return this.currentTab},closeCurrentTab:function(){this.currentTab&&this.closeTab(this.currentTab.id)},getCurrentTabIndex:function(){return this.getTabIndex(this.currentTab)},closeAllTabs:function(){for(var t=this,e=0;e<t.tabs.length;e++)t.tabs[e].close();t.tabs=[],t.tabsMap={},t.currentTab=null,t.doLayout()},closeOtherTabs:function(t){for(var e=this,a=0;a<e.tabs.length;a++){var n=e.tabs[a];n!=t&&n.close()}e.tabs=[t],e.tabsMap={},e.tabsMap[t.id]=t,e.switchTab(t),e.doLayout()},getTabIndex:function(t){for(var e=0;e<this.tabs.length;e++)if(t==this.tabs[e])return e;return-1},findTab:function(t){var e=null,a=null,n=null;return"string"==typeof t?(n=this.tabsMap[t],e=t,a=this.getTabIndex(n)):"number"==typeof t?(e=(n=this.tabs[t]).id,a=t):"object"==typeof t&&(e=(n=t).id,a=this.getTabIndex(n)),{tabId:e,tabIdx:a,tab:n}},addTab:function(t){var a=this;a.tabs.push(t),a.tabsMap[t.id]=t,t.addListener("load",function(){var t=e(".navtab-iframe",this.$tabContent);if(t[0]){var n=a.$ct.height()-a.$tabHeader.outerHeight(!0)-(a.$tabContent.outerHeight(!0)-a.$tabContent.height())-6;t.css("height",n)}})},removeTab:function(t){var e=this.getTabIndex(t);this.tabs.splice(e,1),delete this.tabsMap[t.id]},doLayout:function(){var t=this,e=t.$tabs.width(),a=t.getTabsWidth(),n=t.getLeft();a>=e?(t.$tabs.addClass("navtab-tabs-scrollbtn"),t.$tabsLeft.show(),t.$tabsRight.show()):(t.$tabs.removeClass("navtab-tabs-scrollbtn"),t.$tabsLeft.hide(),t.$tabsRight.hide()),a<=e?t.scrollTab(0):a+n<e&&t.scrollTab(e-a)},scrollLeft:function(t){this.$tabs.width(),this.getTabsWidth();var e=this.getLeft(),a=0;a=e<0-t?e+t:0,this.scrollTab(a)},scrollRight:function(t){var e=this.$tabs.width(),a=this.getTabsWidth(),n=this.getLeft(),r=0;r=e-n+t<a?n-t:e-a,this.scrollTab(r)},scrollCurrentTab:function(){var t=this,e=t.$tabs.width(),a=t.getLeft(),n=t.currentTab.$tabHeader.outerWidth(!0),r=t.getTabsWidth(0,t.getCurrentTabIndex());r+a>e?t.scrollTab(e-r):r-n+a<0&&t.scrollTab(n-r)},getLeft:function(){return e("ul",this.$tabs).position().left},getTabsWidth:function(t,e){var a=0,n=this.tabs;t=void 0!=t?t:0,e=void 0!=e?e:n.length-1;for(var r=t;r<=e;r++)a+=n[r].$tabHeader.outerWidth(!0);return a},scrollTab:function(t){e("ul",this.$tabs).animate({left:t},150)}};var a=function(a){var n=this;2==arguments.length?(n.$tabHeader=arguments[0],n.$tabContent=arguments[1],n.id=n.$tabHeader.attr("tabId"),n.title=e("a",n.$tabHeader).text(),n.html=n.$tabContent.html()):(n.id=a.id||"navtab_"+(new Date).getTime()+"_"+parseInt(1e6*Math.random()),n.title=a.title,n.queryType=a.type,n.queryUrl=a.url,n.queryParams=a.data,n.html=a.html,n.$tabHeader=e("<li tabId='"+n.id+"'><a>"+n.title+"</a><span class='navtab-close'>×</span></li>"),n.$tabContent=e("<div class='navtab-content-box' ref-tabId='"+n.id+"'></div>"),a.headerCt.append(n.$tabHeader),a.contentCt.append(n.$tabContent)),n.data=e.extend({},a.extData),t.EventHandler.call(n,a.events)};a.prototype={constructor:a,show:function(){this.$tabHeader.addClass("active"),this.$tabContent.addClass("active"),this.$tabContent.fadeIn(150),this.fireEvent("show")},hide:function(){this.$tabHeader.removeClass("active"),this.$tabContent.removeClass("active"),this.$tabContent.hide(),this.fireEvent("hide")},close:function(){!1!==this.fireEvent("close")&&(this.$tabHeader.remove(),this.$tabContent.remove())},load:function(t){var a=this;t&&(a.queryType=t.type,a.queryUrl=t.url,a.queryParams=t.data,a.html=t.html,e.extend(a.data,t.extData)),a.html?(a.$tabContent.html(a.html),a.fireEvent("load")):a.queryUrl&&e.ajax({type:a.queryType,url:a.queryUrl,data:a.queryParams,cache:!1,beforeSend:function(){a.$tabContent.html('<div class="overlay"><i class="fa fa-refresh fa-spin"></i></div>')},success:function(t){var e=r(t);"string"==typeof e?a.$tabContent.html(t):(a.$tabContent.html(""),n(e.message)),a.fireEvent("load")},error:function(t,e,r){a.$tabContent.html(t.responseText||r||e),n(r)}})},data:function(t,e){var a=this.data;if(1==arguments.length)return a[t];a[t]=e}},EventHandler.extend(a.prototype);var n=function(e){t.MsgBox?t.MsgBox.error(e):window.console?console.log(e):alert(e)},r=function(t){if("string"!=typeof t)return t;try{return e.parseJSON(t)}catch(e){return t}}}(window,jQuery);